add_library(fast-lopq
    autogenerated/lopq-model/lopq_model.pb.cc

    model.cpp
    include/fast-lopq/model.h
)

target_link_libraries(fast-lopq
    ext-blaze
    libprotobuf
)

target_include_directories(fast-lopq PUBLIC "include")
target_include_directories(fast-lopq PRIVATE "include/fast-lopq")

add_custom_target(protoc-run
    COMMAND protoc -I ../proto --cpp_out=autogenerated/lopq-model lopq_model.proto
    WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}
    COMMENT "Run protoc to generate lopq model source in ${CMAKE_CURRENT_SOURCE_DIR}/autogenerated/lopq-model"
    SOURCES ${protoc-run_SOURCES}
)

add_dependencies(fast-lopq
    protoc-run
)
